---
- name: Deploy Complete Home Lab Suite
  hosts: k3s_server
  become: yes
  gather_facts: no
  tasks:
    - name: Deploy Media Stack
      include_tasks: tasks/media-stack-tasks.yml

    - name: Deploy Home Automation Stack  
      include_tasks: tasks/home-automation-tasks.yml

    - name: Deploy Cloud Services Stack
      include_tasks: tasks/cloud-services-tasks.yml

    - name: Display complete homelab summary
      debug:
        msg: |
          ğŸ ğŸ¬â˜ï¸  COMPLETE HOME LAB DEPLOYED!
          ====================================
          
          ğŸ¯ YOUR HOME LAB NOW INCLUDES:
          
          ğŸ“º MEDIA SERVICES:
          â€¢ Plex: https://plex.home.lab (Media streaming)
          â€¢ Radarr: https://radarr.home.lab (Movie management) 
          â€¢ Sonarr: https://sonarr.home.lab (TV show management)
          â€¢ qBittorrent: https://qbittorrent.home.lab (Downloads + VPN)
          â€¢ Overseerr: https://overseerr.home.lab (Request portal)
          â€¢ Prowlarr: https://prowlarr.home.lab (Indexer manager)
          
          ğŸ  HOME AUTOMATION:
          â€¢ Home Assistant: https://hass.home.lab (Smart home hub)
          â€¢ Grocy: https://grocy.home.lab (Household ERP)
          
          â˜ï¸  PERSONAL CLOUD:
          â€¢ Nextcloud: https://nextcloud.home.lab (File sync & office)
          â€¢ Immich: https://immich.home.lab (Photo backup)
          â€¢ Mealie: https://mealie.home.lab (Recipe manager)
          
          ğŸ”§ NEXT STEPS:
          ==============
          1. Configure /etc/hosts or DNS for *.home.lab domains
          2. Trust your internal CA certificate
          3. Configure Mullvad VPN credentials for qBittorrent
          4. Set up Plex claim token for remote access
          5. Connect services (Overseerrâ†’Plex, Prowlarrâ†’*arr apps)
          
          ğŸ“Š MONITORING YOUR HOMELAB:
          kubectl get pods --all-namespaces
          kubectl get pvc --all-namespaces  
          kubectl get svc --all-namespaces | grep LoadBalancer
          
          ğŸ‰ Welcome to your self-hosted digital life!
          
          Your K3s cluster now provides enterprise-grade services for:
          âœ… Media streaming and management
          âœ… Smart home automation  
          âœ… Personal cloud storage
          âœ… Photo backup and organization
          âœ… Recipe and household management
          âœ… Secure torrenting with VPN
          
          Total Services Deployed: 11 applications + 4 databases
          Namespaces: media, home-automation, cloud-services
          
          ğŸ”’ Security Features:
          â€¢ VPN protection for torrenting
          â€¢ TLS certificates for all services
          â€¢ Persistent data storage
          â€¢ Resource limits and isolation